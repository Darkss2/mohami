<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø®Ø¯Ù…Ø§ØªÙ†Ø§ | Nabra Dziriya</title>

<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      fontFamily: { sans: ['Cairo','sans-serif'] },
      colors: { brand:{ primary:'#1e3a8a', gold:'#fbbf24', dark:'#0f172a'} }
    }
  }
}
</script>
</head>

<body class="bg-gray-50 font-sans">

<!-- NAV -->
<nav class="bg-white shadow sticky top-0 z-50">
  <div class="container mx-auto px-4 py-4 flex justify-between items-center">
    <a href="index.html" class="flex gap-2 items-center">
      <div class="w-10 h-10 bg-brand-gold rounded-lg flex items-center justify-center text-white">
        <i class="fa-solid fa-scale-balanced"></i>
      </div>
      <span class="font-bold text-brand-primary">Ù†Ø¨Ø±Ø© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</span>
    </a>
    <button onclick="toggleCart()" class="relative text-xl text-brand-primary">
      <i class="fa-solid fa-cart-shopping"></i>
      <span id="cart-badge" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center opacity-0">0</span>
    </button>
  </div>
</nav>

<!-- HEADER -->
<header class="bg-brand-primary text-white py-12 text-center">
  <h1 class="text-3xl font-bold">Ø§Ù„Ø®Ø¯Ù…Ø§Øª ÙˆØ§Ù„Ø£Ø³Ø¹Ø§Ø±</h1>
</header>

<!-- CONTENT -->
<main class="container mx-auto px-4 py-10 grid grid-cols-1 md:grid-cols-3 gap-6" id="products-grid">
  <p class="col-span-full text-center text-gray-400">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</p>
</main>

<!-- CART -->
<div id="cart" class="fixed inset-y-0 left-0 w-full md:w-96 bg-white shadow-xl transform -translate-x-full transition z-50 flex flex-col">
  <div class="p-4 bg-brand-dark text-white flex justify-between">
    <span class="font-bold">Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</span>
    <button onclick="toggleCart()"><i class="fa-solid fa-xmark"></i></button>
  </div>

  <div id="cart-items" class="flex-1 p-4 space-y-3"></div>

  <div class="p-4 border-t">
    <div class="flex justify-between font-bold mb-3">
      <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</span>
      <span id="cart-total">0 Ø¯.Ø¬</span>
    </div>
    <button onclick="openCheckout()" class="w-full bg-brand-gold py-3 rounded-xl font-bold">
      Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø·Ù„Ø¨
    </button>
  </div>
</div>

<!-- CHECKOUT -->
<div id="checkout" class="fixed inset-0 bg-black/50 hidden z-50 flex items-center justify-center">
<div class="bg-white rounded-xl w-full max-w-md p-6 space-y-4">

<h2 class="font-bold text-xl text-center">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</h2>

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" class="w-full border p-3 rounded">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ" class="w-full border p-3 rounded">
<input id="address" placeholder="Ø§Ù„ÙˆÙ„Ø§ÙŠØ© / Ø§Ù„Ø¹Ù†ÙˆØ§Ù†" class="w-full border p-3 rounded">

<!-- PAYMENT METHODS -->
<div class="space-y-3">
<label class="font-bold">Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</label>

<label class="flex items-center gap-2 border p-3 rounded cursor-pointer">
<input type="radio" name="pay" value="whatsapp" checked>
<span>ğŸ’¬ ÙˆØ§ØªØ³Ø§Ø¨</span>
</label>

<label class="flex items-center gap-2 border p-3 rounded cursor-pointer">
<input type="radio" name="pay" value="form">
<span>ğŸ“© Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…ÙˆÙ‚Ø¹</span>
</label>

<label class="border p-3 rounded cursor-pointer space-y-2">
<div class="flex gap-2 items-center">
<input type="radio" name="pay" value="chargily">
<span class="font-bold">ğŸ’³ Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span>
</div>
<div class="flex gap-4">
<img class="h-8" src="https://upload.wikimedia.org/wikipedia/commons/2/2a/CIB_Algeria_logo.png">
<img class="h-8" src="https://upload.wikimedia.org/wikipedia/commons/8/88/Edahabia_card_logo.png">
</div>
</label>
</div>

<button onclick="confirmOrder()" class="w-full bg-brand-primary text-white py-3 rounded-xl font-bold">
ØªØ£ÙƒÙŠØ¯
</button>

</div>
</div>

<script>
let products=[], cart=[];

fetch('/content/products.json')
.then(r=>r.json())
.then(d=>{
products=d.items;
document.getElementById('products-grid').innerHTML=
products.map(p=>`
<div class="bg-white p-4 rounded shadow">
<img src="${p.image}" class="h-40 w-full object-cover rounded">
<h3 class="font-bold mt-2">${p.title}</h3>
<p class="text-sm text-gray-500">${p.description}</p>
<div class="flex justify-between items-center mt-3">
<span class="font-bold">${p.price} Ø¯.Ø¬</span>
<button onclick="addToCart('${p.id}')" class="bg-brand-dark text-white px-3 py-1 rounded">+</button>
</div>
</div>
`).join('');
});

function addToCart(id){
cart.push(products.find(p=>p.id===id));
updateCart();
toggleCart(true);
}

function updateCart(){
document.getElementById('cart-badge').textContent=cart.length;
document.getElementById('cart-badge').style.opacity=cart.length?1:0;
document.getElementById('cart-total').textContent=
cart.reduce((s,i)=>s+i.price,0)+' Ø¯.Ø¬';
document.getElementById('cart-items').innerHTML=
cart.map(i=>`<div>${i.title} - ${i.price} Ø¯.Ø¬</div>`).join('');
}

function toggleCart(force){
const c=document.getElementById('cart');
c.classList.toggle('-translate-x-full',!force && !c.classList.contains('-translate-x-full'));
}

function openCheckout(){
if(!cart.length) return alert('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©');
toggleCart();
document.getElementById('checkout').classList.remove('hidden');
}

async function confirmOrder(){
const method=document.querySelector('input[name="pay"]:checked').value;
const total=cart.reduce((s,i)=>s+i.price,0);

if(method==="chargily"){
const r=await fetch('/.netlify/functions/chargily-payment',{
method:'POST',
headers:{'Content-Type':'application/json'},
body:JSON.stringify({amount:total})
});
const d=await r.json();
window.location.href=d.checkout_url;
return;
}

alert('ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù…Ø®ØªØ§Ø±Ø©');
}
</script>

</body>
</html>
